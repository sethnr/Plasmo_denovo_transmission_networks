rtg format -o PF3D7.sdf $PFREF

for F in {disco,gatk}*.vcf.gz ; do
  echo qsubNN rocplot 1 32 rtg RTG_MEM=32g vcfeval -b 3D7_DD2_parents.DD2.CALLBOTH.vcf.gz \
         -c $F -o ${F/.vcf.gz/}_EVAL \
	 --all-records \
         -t Pf3D7.sdf --vcf-score-field="QUAL"
  for B in *bed; do
	echo qsubNN rocplot 1 32 rtg RTG_MEM=32g vcfeval -b 3D7_DD2_parents.DD2.CALLBOTH.vcf.gz \
         -c $F -o ${F/.vcf.gz/}_${B/.bed/}_EVAL \
	 --all-records --bed-regions ${B} \
         -t Pf3D7.sdf --vcf-score-field="QUAL"
  done
done > doAllROC.qual.sh 

#do ROCPLOTS
 qsubNNarr rocplot 1 16 doAllROC.qual.sh

#do VCF annotation

java -jar $GATK/GenomeAnalysisTK.jar \
   -R $PFREF \
   -T VariantAnnotator \
   -I /seq/plasmodium/sredmond/pfdisco/gatkHaplo_3D7DD2_450250/SM-7LV8R.3D7.250.s.bam \
   -V  disco_3D7DD2.FILT.DD2-2D4.vcf.gz \
   -o  disco_3D7DD2.FILT.DD2-2D4.ANN.vcf \
   -A QualByDepth \
   -A RMSMappingQuality \
   -A FisherStrand \
   -A DepthPerAlleleBySample \
   -A Coverage \
   -A StrandOddsRatio

#QD / MQ / FS / DP / SOR
#MV ann to core VCF

#do disco VQSR
qsubNN vqsr 1 16 ~/bin/VQSR_PFX -V   disco_3D7DD2.FILT.DD2-2D4.vcf.gz -o disco_3D7DD2.FILT.DD2-2D4.VQSR

for V in  ../ROCplot/3D7DD2.REFCALL.PASS.DD2CONC.PFX.LMRG.HAP.CALLBOTH.Dd2-2D4.vcf.gz ../ROCplot/3D7DD2.REFCALL.PASS.DD2CONC.PFX.LMRG.HAP.Dd2-2D4.vcf.gz disco_3D7DD2.FILT.DD2-2D4.vcf.gz ; do echo $V ; zcat $V | wc -l ; cat ${V/.vcf.gz/_EVAL}/summary.txt ;  cat ${V/.vcf.gz/_FILT_EVAL}/summary.txt ; done

for V in ../ROCplot/3D7DD2.REFCALL.PASS.DD2CONC.PFX.LMRG.HAP.Dd2-2D4.vcf.gz  disco_3D7DD2.FILT.DD2-2D4.vcf.gz ;
do
   echo $V ; zcat $V | wc -l ;
   cat ${V/.vcf.gz/_EVAL}/summary.txt ;
   cat ${V/.vcf.gz/_FILT_EVAL}/summary.txt ;
done

for D in  ../ROCplot/3D7DD2.REFCALL.PASS.DD2CONC.PFX.LMRG.HAP.CALLBOTH.Dd2-2D4  disco_3D7DD2.FILT.DD2-2D4_callable_all ;
do
echo $D ; cat ${D}_EVAL/summary.txt ; cat ${D}_FILT_EVAL/summary.txt ;
done




#copy VQSLOD into discovar table
java -jar $GATK/GenomeAnalysisTK.jar \
   -R $PFREF \
   -T VariantAnnotator \
   -V  disco_3D7DD2.FILT.DD2-2D4.ANN.vcf.gz  \
   -o  disco_3D7DD2.FILT.DD2-2D4.ANN.VQSLOD.vcf  \
   --resource:ann  disco_DD22D4_L12_allvars.variant.VQSR.vcf.gz \
   --expression ann.VQSLOD
 
vcftools --non-ref-ac 1 --gzvcf gatkHaplo_3D7DD2_100.VQSR.DD2-2D4.vcf.gz --recode --recode-INFO-all --out gatkHaplo_3D7DD2_100.VQSR.DD2-2D4.nr
qsubNN rocplot 1 32 rtg RTG_MEM=32g vcfeval -b 3D7_DD2_parents.DD2.CALLBOTH.vcf.gz -c disco_3D7DD2.VQSR90.DD2-2D4.vcf.gz -o disco_3D7DD2.VQSR90.DD2-2D4_callable_all_FILT_EVAL --bed-regions callable_all.bed -t Pf3D7.sdf --vcf-score-field=INFO=VQSLOD
qsubNN rocplot 1 32 rtg RTG_MEM=32g vcfeval -b 3D7_DD2_parents.DD2.CALLBOTH.vcf.gz -c disco_3D7DD2.VQSR90.DD2-2D4.vcf.gz -o disco_3D7DD2.VQSR90.DD2-2D4_callable_disco_FILT_EVAL --bed-regions callable_disco.bed -t Pf3D7.sdf --vcf-score-field=INFO=VQSLOD

qsubNN rocplot 1 32 rtg RTG_MEM=32g vcfeval -b 3D7_DD2_parents.DD2.CALLBOTH.vcf.gz -c disco_3D7DD2.VQSR90.DD2-2D4.vcf.gz -o disco_3D7DD2.VQSR90.DD2-2D4_callable_all_EVAL --all-records --bed-regions callable_all.bed -t Pf3D7.sdf --vcf-score-field=INFO=VQSLOD
qsubNN rocplot 1 32 rtg RTG_MEM=32g vcfeval -b 3D7_DD2_parents.DD2.CALLBOTH.vcf.gz -c disco_3D7DD2.VQSR90.DD2-2D4.vcf.gz -o disco_3D7DD2.VQSR90.DD2-2D4_callable_disco_EVAL --all-records --bed-regions callable_disco.bed -t Pf3D7.sdf --vcf-score-field=INFO=VQSLOD 
