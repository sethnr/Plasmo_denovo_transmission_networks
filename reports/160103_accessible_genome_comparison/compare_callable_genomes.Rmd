library(ggplot2)
library(knitr)
library(reshape2)
library(hexbin)
```{r setup}
opts_chunk$set(fig.width=12, fig.height=7)

``` 

```{r}
calcols <- c("ch","st","en","NV","LDfails","LDpass","RSfails","RSpass","df","dn","Dpass","multipass")
callable1k_disco <- read.table("qDD2vr3D7.callable.blocks1k.tab.txt",stringsAsFactors = T,sep='\t',header=F,col.names = calcols)
callable1k_haplo <- read.table("fakeNGS_haplo_qDD2r3D7_rl100.callable.1k.txt",stringsAsFactors = T,sep='\t',header=F,col.names = calcols)

callable1k_disco <- callable1k_disco[,c(1,2,3,12)]
callable1k_haplo <- callable1k_haplo[,c(1,2,3,12)]
colnames(callable1k_disco)[[4]] <- "disco"
colnames(callable1k_haplo)[[4]] <- "haplo"

callable1k<-merge(callable1k_disco,callable1k_haplo)
callable1k$accessible <- NULL
callable1k[callable1k$disco=="True" & callable1k$haplo=="False","accessible"] <- "DISCOVAR only"
callable1k[callable1k$disco=="False" & callable1k$haplo=="True","accessible"] <- "haplo only"
callable1k[callable1k$disco=="False" & callable1k$haplo=="False","accessible"] <- "inacessible"

levels(callable1k$ch) <- c("MIT","01","02","03","04","05","06","07","08","09","10","11","12","13","14","API")
callable1k <- subset(callable1k,!ch %in% c("MIT","API"))
```



```{r}
calcols <- c("ch","st","en","NV","LDfails","LDpass","RSfails","RSpass","df","dn","Dpass","multipass")
callable5k_disco <- read.table("qDD2vr3D7.callable.blocks5k.tab.txt",stringsAsFactors = T,sep='\t',header=F,col.names = calcols)
callable5k_haplo <- read.table("fakeNGS_haplo_qDD2r3D7_rl100.callable.5k.txt",stringsAsFactors = T,sep='\t',header=F,col.names = calcols)

callable5k_disco <- callable5k_disco[,c(1,2,3,12)]
callable5k_haplo <- callable5k_haplo[,c(1,2,3,12)]
colnames(callable5k_disco)[[4]] <- "disco"
colnames(callable5k_haplo)[[4]] <- "haplo"

callable5k<-merge(callable5k_disco,callable5k_haplo)
callable5k$accessible <- NULL # "accessible"
callable5k[callable5k$disco=="True" & callable5k$haplo=="False","accessible"] <- "DISCOVAR only"
callable5k[callable5k$disco=="False" & callable5k$haplo=="True","accessible"] <- "haplo only"
callable5k[callable5k$disco=="False" & callable5k$haplo=="False","accessible"] <- "inacessible"

levels(callable5k$ch) <- c("MIT","01","02","03","04","05","06","07","08","09","10","11","12","13","14","API")
callable5k <- subset(callable5k,!ch %in% c("MIT","API"))
```

```{r}
chrnames <- c("MIT","01","02","03","04","05","06","07","08","09","10","11","12","13","14","API")
chrlen <- data.frame("ch"=chrnames,"st"=rep(0,length(chrnames)),"en"=aggregate(callable5k_disco$en,list(callable5k_disco$ch),FUN=max)[,2])
chrlen <- subset(chrlen,!ch %in% c("MIT","API"))

```


```{r}

blank_theme <-   theme(axis.line.y=element_blank(), axis.ticks.y=element_blank(),axis.text.y=element_blank(),
        panel.background=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        legend.position="bottom")

ggplot(callable5k,aes(xmin=st,xmax=en,ymin=0,ymax=1)) + 
  ggtitle(paste("accessible regions (5kb windows)")) +
  geom_rect(aes(fill=accessible)) + scale_fill_manual(values=c("blue","orange","grey"))+
  geom_rect(data=chrlen, fill=NA,colour="black")+
  facet_grid(ch ~ .)  + blank_theme
 #+ theme(strip.text.y = element_text(angle=0)) 


ggplot(callable1k,aes(xmin=st,xmax=en,ymin=0,ymax=1)) + 
  ggtitle(paste("accessible regions (1kb windows)")) +
  geom_rect(aes(fill=accessible)) + scale_fill_manual(values=c("blue","orange","grey"))+
  geom_rect(data=chrlen, fill=NA,colour="black")+
  facet_grid(ch ~ .)  + blank_theme


```

