netAll <- getAnces(net, 1,1:10)
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
```
```{r}
opts_chunk$set(fig.width=22, fig.height=8)
opts_chunk$set(dev=c('png','postscript'))
```
```{r}
corer1 <- getEvolRates(indelNets[[1]],coreDists)
inaccr1 <- getEvolRates(indelNets[[1]],(indDists+snpDists)-coreDists)
#CORE GENOME
cplot <- ggplot(corer1,aes(x=time,y=rate/12)) +
geom_boxplot(aes(group=time),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, accessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5) +
theme(legend.position="none")
corer1 <- getEvolRates(indelNets[[1]],coreDists)
getEvolRates <- function(net,mat,ng) {
netAll <- getAnces(net, net$id[1],net$id)
D <- as.dist(sym(mat))
names <- colnames(mat)
mat <- as.matrix(sym(mat))
outgroups <- setdiff(names,net$name)
outtab <- data.frame(from=character(),
to=character(),
out=character(),
time=integer(),
distance=numeric(),
rate=numeric(),
stringsAsFactors=FALSE)
for (i in c(1:dim(netAll)[[1]])) {
if(!is.na(netAll$ances[i])) {
sample = netAll$name[i]
ances = netAll$name[netAll$ances[i]]
dists = c()
time <- as.integer(netAll$year[i] - netAll$year[netAll$ances[i]])
for (o in outgroups) {
dist <- mat[sample,o]-mat[ances,o]
dists <- c(dists, dist)
outtab[dim(outtab)[1]+1,1:3]=c(ances,sample,o)
outtab[dim(outtab)[1],4:6]=c(time,dist,round(dist/time,2))
}
dists <- round(dists/time)
#paste(dists,collapse = ","),
#      write(paste(ances,sample,time,round(mean(dists),2),round(sd(dists),2),sep="\t"),stdout())
#      write(paste(ances,sample,outgroups,time,dists,sep="\t"),stdout())
}
}
outtab$pair <- paste(outtab$from,outtab$to)
outtab
}
netAll <- getAnces(net, 1,1:10)
netAll <- getAnces(net, 1,1:10)
netAll <- net
net <- indelNets[[1]]
netAll <- net
getAnces <- function(net, leaf, ids=character()) {
id = ids[1]
ances = netAll[id,"ances"]
date = netAll[id,"date"]
ances.date = netAll[id,"ances.date"]
#write(paste(leaf,id,ances,sep="\t"),stderr())
if (!is.na(ances)) {
if (id != leaf) {
leaf.date = net[leaf,"date"]
leaf.year = net[leaf,"year"]
leaf.name = net[leaf,"name"]
nextI = dim(net)[[1]]+1
#        write(paste("  adding",nextI,":",leaf,ances,sep=" "),stderr())
net[nextI,1:2] <- c(leaf, ances)
net[nextI,6] <- leaf.year
net[nextI,7] <- leaf.name
}
net <- getAnces(net,leaf,c(ances))
}
if (length(ids) > 1){
ids <- ids[ids != id]
#       write(paste("proceeding:",ids[1],sep=" "),stderr())
net <- getAnces(net,ids[1],ids)
}
net
}
getEvolRates <- function(net,mat,ng) {
netAll <- getAnces(net, net$id[1],net$id)
D <- as.dist(sym(mat))
names <- colnames(mat)
mat <- as.matrix(sym(mat))
outgroups <- setdiff(names,net$name)
outtab <- data.frame(from=character(),
to=character(),
out=character(),
time=integer(),
distance=numeric(),
rate=numeric(),
stringsAsFactors=FALSE)
for (i in c(1:dim(netAll)[[1]])) {
if(!is.na(netAll$ances[i])) {
sample = netAll$name[i]
ances = netAll$name[netAll$ances[i]]
dists = c()
time <- as.integer(netAll$year[i] - netAll$year[netAll$ances[i]])
for (o in outgroups) {
dist <- mat[sample,o]-mat[ances,o]
dists <- c(dists, dist)
outtab[dim(outtab)[1]+1,1:3]=c(ances,sample,o)
outtab[dim(outtab)[1],4:6]=c(time,dist,round(dist/time,2))
}
dists <- round(dists/time)
#paste(dists,collapse = ","),
#      write(paste(ances,sample,time,round(mean(dists),2),round(sd(dists),2),sep="\t"),stdout())
#      write(paste(ances,sample,outgroups,time,dists,sep="\t"),stdout())
}
}
outtab$pair <- paste(outtab$from,outtab$to)
outtab
}
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
```
```{r}
opts_chunk$set(fig.width=22, fig.height=8)
opts_chunk$set(dev=c('png','postscript'))
```
```{r}
corer1 <- getEvolRates(indelNets[[1]],coreDists)
inaccr1 <- getEvolRates(indelNets[[1]],(indDists+snpDists)-coreDists)
#CORE GENOME
cplot <- ggplot(corer1,aes(x=time,y=rate/12)) +
geom_boxplot(aes(group=time),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, accessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5) +
theme(legend.position="none")
iaplot <- ggplot(inaccr1,aes(x=time,y=rate/12)) +
geom_boxplot(aes(group=time),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5)
legend <- g_legend(iaplot)
grid.arrange(cplot, iaplot + theme(legend.position="none"),legend, nrow=1,widths=c(10,10,1),heights=c(1))
library(gridExtra)
grid.arrange(cplot, iaplot + theme(legend.position="none"),legend, nrow=1,widths=c(10,10,1),heights=c(1))
corer1
corer1$timeF <- paste(coreR1$time,"a",sep="_")
corer1$timeF <- paste(corer1$time,"a",sep="_")
corer1
inaccr1$timeF <- paste(inaccr1$time,"i",sep="_")
rbind(corer1,inaccr1)
allrates <- rbind(corer1,inaccr1)
factor(allrates$timeF)
allrates$timeF <- factor(allrates$timeF)
allrates
corer1$region <- "core"
inaccr1$region <- "inaccessible"
allrates <- rbind(corer1,inaccr1)
allrates$timeF <- factor(allrates$timeF)
ggplot(allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(aes(group=timeF),fill=NA,colour=region) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5)
head(allrates)
ggplot(allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(aes(group=timeF,colour=region),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5)
ggplot(allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(aes(group=timeF),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5)
ggplot(allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(aes(group=timeF),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(aes(group=timeF),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3,group=region) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(aes(group=timeF),fill=NA) + geom_hline(aes(yintercept=mean(rate/12),group=region),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),colour="white") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),colour="white")
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),colour="white")
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="white")
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="grey")
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="dark grey")
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="dark grey") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="dark grey") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="dark grey") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region="inaccessible"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region="core"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region=="core"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region=="inaccessible"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region=="core"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region=="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region=="inaccessible"),aes(group=timeF),fill=NA,colour="white") + geom_hline(data=subset(allrates,region=="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region=="core"),aes(group=timeF),fill=NA,colour="black") + geom_hline(data=subset(allrates,region=="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_boxplot(data=subset(allrates,region=="inaccessible"),aes(group=timeF),fill=NA,colour="grey") + geom_hline(data=subset(allrates,region=="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region=="core"),aes(group=timeF),fill=NA,colour="black") +
geom_hline(data=subset(allrates,region=="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_label(data=subset(allrates,region=="core"),aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
geom_boxplot(data=subset(allrates,region=="inaccessible"),aes(group=timeF),fill=NA,colour="grey") +
geom_hline(data=subset(allrates,region=="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_label(data=subset(allrates,region=="inaccessible"),aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region=="core"),aes(group=timeF),fill=NA,colour="black") +
geom_hline(data=subset(allrates,region=="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_label(data=subset(allrates,region=="core"),aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
geom_boxplot(data=subset(allrates,region=="inaccessible"),aes(group=timeF),fill=NA,colour="#BBBBBB") +
geom_hline(data=subset(allrates,region=="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_label(data=subset(allrates,region=="inaccessible"),aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=allrates,aes(x=timeF,y=rate/12)) +
geom_boxplot(data=subset(allrates,region=="core"),aes(group=timeF),fill=NA,colour="black") +
geom_hline(data=subset(allrates,region=="core"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_label(data=subset(allrates,region=="core"),aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
geom_boxplot(data=subset(allrates,region=="inaccessible"),aes(group=timeF),fill=NA,colour="#555555") +
geom_hline(data=subset(allrates,region=="inaccessible"),aes(yintercept=mean(rate/12)),linetype=3) +
geom_label(data=subset(allrates,region=="inaccessible"),aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=mean)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=se)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=stderr)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=stderr)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=mean)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=stderr)
?stderr
aggregate(allrates$rate,by=list(allrates$timeF),FUN=stdev)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=sdev)
aggregate(allrates$rate,by=list(allrates$timeF),FUN=function(x) {sd(x)/sqrt(length(x))})
allrates
unique(allrates[,c("from","to","out","time","distance","region")]
)
unique(allrates[,c("from","to","time","distance","region")]
)
unique(allrates[,c("from","to","time","distance","region")])
unique(allrates[,c("from","to","time","region")])
unique(allrates[,c("from","to","time","region","timeF")])
aggregate(allrates$rate,by=list(allrates$timeF),FUN=mean)
aggregate(allrates$rate,by=list(paste(allrates$time,allrates$region,allrates$from,allrates$to)),FUN=mean)
allrates$key <- paste(allrates$time,allrates$region,allrates$from,allrates$to)
allrates$key <- paste(allrates$time,allrates$region,allrates$from,allrates$to)
aggregate(allrates$rate,by=list(allrates$key),FUN=mean)
aggregate(allrates$rate,by=list(allrates$key),FUN=function(x) {sd(x)/sqrt(length(x))})
unique(allrates[,c("from","to","time","region","key")])
allratesmean <- unique(allrates[,c("from","to","time","region","key")])
means <- aggregate(allrates$rate,by=list(allrates$key),FUN=mean)
ses <- aggregate(allrates$rate,by=list(allrates$key),FUN=function(x) {sd(x)/sqrt(length(x))})
ses
allrates$key <- paste(allrates$time,allrates$region,allrates$from,allrates$to)
means <- aggregate(allrates$rate,by=list(allrates$key),FUN=mean)
colnames(mean)<-c("key","rate")
means <- as.data.frame(aggregate(allrates$rate,by=list(allrates$key),FUN=mean))
means
colnames(mean)<-c("key","rate")
means <- as.data.frame(aggregate(allrates$rate,by=list(allrates$key),FUN=mean))
colnames(mean)<-c("key","rate")
means
data.frame(aggregate(allrates$rate,by=list(allrates$key),FUN=mean))
data.frame(aggregate(allrates$rate,by=list(allrates$key),FUN=mean))$x
allrates$key <- paste(allrates$time,allrates$region,allrates$from,allrates$to)
means <- data.frame(aggregate(allrates$rate,by=list(allrates$key),FUN=mean))
colnames(means)<-c("key","rate")
ses <- aggregate(allrates$rate,by=list(allrates$key),FUN=function(x) {sd(x)/sqrt(length(x))})
colnames(ses)<-c("key","se")
allrates$key <- paste(allrates$time,allrates$region,allrates$from,allrates$to)
means <- aggregate(allrates$rate,by=list(allrates$key),FUN=mean)
colnames(means)<-c("key","rate")
ses <- aggregate(allrates$rate,by=list(allrates$key),FUN=function(x) {sd(x)/sqrt(length(x))})
colnames(ses)<-c("key","se")
allratesmean <- unique(allrates[,c("from","to","time","region","key")])
merge(allratesmean,means)
merge(merge(allratesmean,means),ses)
merge(merge(allratesmean,means),ses)[,c("from","to","time","region","key","rate","se")]
merge(merge(allratesmean,means),ses)[,c("from","to","time","region","rate","se")]
meanrates <- merge(merge(allratesmean,means),ses)[,c("from","to","time","region","rate","se")]
allrates$key <- paste(allrates$time,allrates$region,allrates$from,allrates$to)
means <- aggregate(allrates$rate/12,by=list(allrates$key),FUN=mean)
colnames(means)<-c("key","rate")
ses <- aggregate(allrates$rate/12,by=list(allrates$key),FUN=function(x) {sd(x)/sqrt(length(x))})
colnames(ses)<-c("key","se")
allratesmean <- unique(allrates[,c("from","to","time","region","key")])
meanrates <- merge(merge(allratesmean,means),ses)[,c("from","to","time","region","rate","se")]
meanrates
ggplot(data=meanrates,aes(x=time,y=rate)) +
geom_point(aes(colour=to,shape=from),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
allratesmean <- unique(allrates[,c("from","to","time","timeF","region","key")])
meanrates <- merge(merge(allratesmean,means),ses)[,c("from","to","time","region","rate","se")]
ggplot(data=meanrates,aes(x=time,y=rate)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_point(aes(colour=to,shape=from),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_point(aes(colour=to,shape=from),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
allratesmean <- unique(allrates[,c("from","to","time","timeF","region","key")])
meanrates <- merge(merge(allratesmean,means),ses)[,c("from","to","time","timeF","region","rate","se")]
ggplot(data=meanrates,aes(x=timeF,y=rate)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_point(aes(colour=to,shape=from),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(aes(colour=to,shape=from),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(aes(colour=region,shape=from),size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(subset(meanrates,region="core"),colour="white",size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region="core"),colour="white",size=3)+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region="core"),colour="white")+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="#444444")+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="#777777")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="yellow")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
ggtitle("evolutionary rate, inaccessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
ggtitle("evolutionary rate, inaccessible/accessible genome") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
theme(panel.background = element_rect(colour = "grey"))+
ggtitle("evolutionary rate, inaccessible/accessible genome") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
theme(panel.background = element_rect(colour = "#555555"))+
ggtitle("evolutionary rate, inaccessible/accessible genome") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
theme(panel.background = element_rect(colour = "black"))+
ggtitle("evolutionary rate, inaccessible/accessible genome") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=time,y=rate,group=region,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
theme(panel.background = element_rect(colour = "black"))+
ggtitle("evolutionary rate, inaccessible/accessible genome") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
ggplot(data=meanrates,aes(x=timeF,y=rate,ymin=rate-se,ymax=rate+se)) +
geom_point(aes(colour=to,shape=from),size=3)+
geom_errorbar(data=subset(meanrates,region=="core"),colour="white")+
geom_errorbar(data=subset(meanrates,region=="inaccessible"),colour="black")+
theme(panel.background = element_rect(colour = "black"))+
ggtitle("evolutionary rate, inaccessible/accessible genome") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9)
knit("evol_rate.Rmd")
knit("evol_rate.Rmd")
knit("evol_rate.Rmd")
cplot <- ggplot(corer1,aes(x=time,y=rate/12)) +
geom_boxplot(aes(group=time),fill=NA) + geom_hline(aes(yintercept=mean(rate/12)),linetype=3) +
geom_point(aes(colour=to,shape=from),position=position_jitter(width=0.5),size=3)+
geom_label(inherit.aes=F,aes(label=paste(round(mean(rate/12),2)," (+/- ",round(sd(rate/12),1),")",sep=""),y=mean(rate/12),x=7.3),size=5)+
ggtitle("evolutionary rate, accessible genome only, clade 2") + ylab("mut/mth/gen") + xlab("years")  + ylim(-2,9) + xlim(0,7.5) +
theme(legend.position="none")
cplot
knit("evol_rate.Rmd")
knit("evol_rate.Rmd")
knit("evol_rate.Rmd")
ggplot(subset(sppsubs,Label %in% barSamps),aes(x=Pathogen,y=subrate * gsize),) +
geom_bar(aes(fill=Group,alpha=region),stat = "identity",size=3) +
geom_label(data=subset(sppsubs,Label %in% labelSamps),aes(label=newmut))+
geom_label(data=subset(sppsubs,Label %in% midLabelSamps),aes(label=newmut, y=(subrate * gsize)/2))+
#  scale_alpha_manual(values=c("SNP"=0.9,"INDEL"=0.6,"SNP+INDEL"=1))+
scale_alpha_manual(values=c("all"=1,"accessible"=1,"inaccessible"=0.8))+
ylab("mutation rate (muts / genome / year)")+
theme(panel.background = element_rect(fill = F),axis.text.x = element_text(angle = 90, hjust = 1))
setwd("../161212_beast_sub_rates2/")
setwd("../161117_evol_rate/")
net <- indelNets[[1]]
indDists <- read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.INDEL.recode.vcf.dist.tab.txt",sep="\t")
snpDists <- read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.SNP.recode.vcf.dist.tab.txt",sep="\t")
coreDists <- read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.CALLBOTH.vcf.dist.tab.txt",sep="\t")
indDists+snpDists
melt(indDists+snpDists)
alldists <- melt(indDists+snpDists)
alldists <- indDists+snpDists
upper(alldists)
upper.tri(alldists)
lower.tri(alldists)
alldists[lower.tri(alldists)] = alldists[upper.tri(alldists)]
alldists
alldists$from=rownames(alldists)
melt(alldists,id.vars = 'from',value.name = 'to')
alldists <- melt(alldists,id.vars = 'from',value.name = 'to')
subset(alldists,variable<10000 & variable > 0)
subset(alldists,variable<10000 && variable > 0)
head(alldists)
subset(alldists,variable<10000)
alldists$variable
head(alldists)
alldists <- melt(alldists,id.vars = 'from',variable.name = 'to')
alldists <- melt(alldists,id.vars = 'from',variable.name = 'to')
alldists <- melt(alldists,id.vars = 'from',value.name = 'to')
alldists <- indDists+snpDists
alldists[lower.tri(alldists)] = alldists[upper.tri(alldists)]
melt(alldists,id.vars = 'from',variable.name = 'to')
alldists$from=rownames(alldists)
melt(alldists,id.vars = 'from',variable.name = 'to')
alldists <- melt(alldists,id.vars = 'from',variable.name = 'to')
subset(alldists,variable<10000 && variable > 0)
subset(alldists,value<10000 && value > 0)
subset(alldists,value<10000 & value > 0)
alldists <- subset(alldists,value<10000 & value > 0)
write.table("discovar_hamming_distance.tab.txt",alldists)
write.table(alldists,"discovar_hamming_distance.tab.txt")
getwd()
write.table(alldists,"discovar_hamming_distance.tab.txt",col.names = F, quote=F)
write.table(alldists,"discovar_hamming_distance.tab.txt",row.names = F, quote=F)
