meta <- read.table("Thies_metadata_1701.txt",sep="\t",header=T)
colnames(meta)[1]<-"name"
meta <- meta[!is.na(meta$Age),]
discoDists <- read.table("thies_disco.FILT.m0.5.vcf.gz.dist.tab.txt",header=T,sep="\t")
meta <- subset(meta,name %in% names(discoDists))
rownames(meta) <- meta$name
hap100Dists <- read.table("thies_haplo100.FILT.m0.5.vcf.gz.dist.tab.txt",header=T,sep="\t")
hap250Dists <- read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",header=T,sep="\t")
samples <- read.table("../180224_core_callable_VQSLOD90/Thies.samples.txt",col.names=c("ID","lane","dataset","sample","bam"))
samples <- unique(samples[,c("ID","sample")])
snames <- samples[,c("ID")]; samples<- as.character(samples[,c("sample")]) ; names(samples) <- snames
#fix names for hap100 tree
names(hap100Dists) <- samples[rownames(hap100Dists)]
rownames(hap100Dists) <- samples[rownames(hap100Dists)]
```
```{r}
cl1 <- c("Th086.07", "Th106.09", "Th106.11", "Th117.11", "Th132.11", "Th134.11", "Th162.12", "Th196.12", "Th230.12", "Th074.13")
cl1yrs <- as.numeric(gsub(".*\\.","",cl1))
cl2 <- c("Th166.12", "Th092.13", "Th211.13", "Th245.13", "Th246.13")
cl3 <- c("Th068.12", "Th061.13", "Th095.13")
```
#MAKE DISCOVAR TREES
```{r}
discoAlleles <- read.table("thies_disco.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
discoGenos <- t(data.matrix(discoAlleles[6:dim(discoAlleles)[2]]))
inds <- row.names(discoGenos)
genosDat <- as.phyDat(discoGenos, type="USER", levels = c(0:max(discoGenos,na.rm=T)))
discoPTree <- pratchet(genosDat) # ,njtree1)
discoPTree <- nnls.phylo(discoPTree,dist.hamming(genosDat))
discoPTree <- midpoint(discoPTree)
discoPTree1 <- drop.tip(discoPTree,c(cl2,cl3))
discoPTree2 <- drop.tip(discoPTree,c(cl3,cl1))
discoPTree3 <- drop.tip(discoPTree,c(cl1,cl2))
plot(discoPTree)
plot(discoPTree1)
plot(discoPTree2)
plot(discoPTree3)
```
#MAKE Hap250 TREES
```{r}
hap250Alleles <- read.table("thies_haplo250.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
hap250Genos <- t(data.matrix(hap250Alleles[6:dim(hap250Alleles)[2]]))
inds <- row.names(hap250Genos)
genosDat <- as.phyDat(hap250Genos, type="USER", levels = c(0:max(hap250Genos,na.rm=T)))
hap250PTree <- pratchet(genosDat) # ,njtree1)
hap250PTree <- nnls.phylo(hap250PTree,dist.hamming(genosDat))
hap250PTree <- midpoint(hap250PTree)
hap250PTree1 <- drop.tip(hap250PTree,c(cl2,cl3))
hap250PTree2 <- drop.tip(hap250PTree,c(cl3,cl1))
hap250PTree3 <- drop.tip(hap250PTree,c(cl1,cl2))
plot(hap250PTree)
plot(hap250PTree1)
plot(hap250PTree2)
plot(hap250PTree3)
```
#MAKE Hap100 TREES
```{r}
hap100Alleles <- read.table("thies_haplo100.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
cnames <- gsub("SM.","SM-",colnames(hap100Alleles))
cnames[cnames %in% names(samples)] <- samples[cnames[cnames %in% names(samples)]]
colnames(hap100Alleles) <- cnames
hap100Genos <- t(data.matrix(hap100Alleles[6:dim(hap100Alleles)[2]]))
inds <- row.names(hap100Genos)
genosDat <- as.phyDat(hap100Genos, type="USER", levels = c(0:max(hap100Genos,na.rm=T)))
hap100PTree <- pratchet(genosDat) # ,njtree1)
hap100PTree <- nnls.phylo(hap100PTree,dist.hamming(genosDat))
hap100PTree <- midpoint(hap100PTree)
hap100PTree1 <- drop.tip(hap100PTree,c(cl2,cl3))
hap100PTree2 <- drop.tip(hap100PTree,c(cl3,cl1))
hap100PTree3 <- drop.tip(hap100PTree,c(cl1,cl2))
plot(hap100PTree)
plot(hap100PTree1)
plot(hap100PTree2)
plot(hap100PTree3)
```
#MAKE LENTO PLOTS
#CLADE 1
```{r}
#get support for each split, and split dot matrix
discoPSuppCl1 <- getSplitSupports(discoPTree1,discoGenos[cl1,])
discoPSplitsCl1 <- getSplitPlot(discoPTree1)
#order by most-supported split
splitSort <- discoPSuppCl1$splits[rev(order(discoPSuppCl1$pro))]
discoPSplitsCl1$splits <- factor(discoPSplitsCl1$splits,levels=splitSort, ordered=T)
discoSplitP1 <- ggplot(discoPSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
discoPSuppP1 <- ggplot(discoPSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(discoPSuppP1 + blankTheme, discoSplitP+blankTheme, ncol=1)
```
```{r}
#get support for each split, and split dot matrix
hap250PSuppCl1 <- getSplitSupports(hap250PTree1,hap250Genos[cl1,])
hap250PSplitsCl1 <- getSplitPlot(hap250PTree1)
#order by most-supported split
splitSort <- hap250PSuppCl1$splits[rev(order(hap250PSuppCl1$pro))]
hap250PSplitsCl1$splits <- factor(hap250PSplitsCl1$splits,levels=splitSort, ordered=T)
hap250PSuppCl1$splits <- factor(hap250PSuppCl1$splits,levels=splitSort, ordered=T)
hap250SplitP1 <- ggplot(hap250PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
hap250PSuppP1 <- ggplot(hap250PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(hap250PSuppP1 + blankTheme, hap250SplitP1+blankTheme, ncol=1)
```
```{r}
#get support for each split, and split dot matrix
hap100PSuppCl1 <- getSplitSupports(hap100PTree1,hap100Genos[cl1,])
hap100PSplitsCl1 <- getSplitPlot(hap100PTree1)
#order by most-supported split
splitSort <- hap100PSuppCl1$splits[rev(order(hap100PSuppCl1$pro))]
hap100PSplitsCl1$splits <- factor(hap100PSplitsCl1$splits,levels=splitSort, ordered=T)
hap100PSuppCl1$splits <- factor(hap100PSuppCl1$splits,levels=splitSort, ordered=T)
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
```
Clade2
```{r}
#get support for each split, and split dot matrix
discoPSuppCl2 <- getSplitSupports(discoPTree2,discoGenos[cl2,])
discoPSplitsCl2 <- getSplitPlot(discoPTree2)
#order by most-supported split
splitSort <- discoPSuppCl2$splits[rev(order(discoPSuppCl2$pro))]
discoPSplitsCl2$splits <- factor(discoPSplitsCl2$splits,levels=splitSort, ordered=T)
discoSplitP2 <- ggplot(discoPSplitsCl2,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
discoPSuppP2 <- ggplot(discoPSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(discoPSuppP2 + blankTheme, discoSplitP2+blankTheme, ncol=1)
```
```{r}
#get support for each split, and split dot matrix
hap250PSuppCl2 <- getSplitSupports(hap250PTree2,hap250Genos[cl2,])
hap250PSplitsCl2 <- getSplitPlot(hap250PTree2)
#order by most-supported split
splitSort <- hap250PSuppCl2$splits[rev(order(hap250PSuppCl2$pro))]
hap250PSplitsCl2$splits <- factor(hap250PSplitsCl2$splits,levels=splitSort, ordered=T)
hap250PSuppCl2$splits <- factor(hap250PSuppCl2$splits,levels=splitSort, ordered=T)
hap250SplitP2 <- ggplot(hap250PSplitsCl2,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
hap250PSuppP2 <- ggplot(hap250PSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(hap250PSuppP2 + blankTheme, hap250SplitP2+blankTheme, ncol=1)
```
```{r}
#get support for each split, and split dot matrix
hap100PSuppCl2 <- getSplitSupports(hap100PTree2,hap100Genos[cl2,])
hap100PSplitsCl2 <- getSplitPlot(hap100PTree2)
#order by most-supported split
splitSort <- hap100PSuppCl2$splits[rev(order(hap100PSuppCl2$pro))]
hap100PSplitsCl2$splits <- factor(hap100PSplitsCl2$splits,levels=splitSort, ordered=T)
hap100PSuppCl2$splits <- factor(hap100PSuppCl2$splits,levels=splitSort, ordered=T)
hap100SplitP2 <- ggplot(hap100PSplitsCl2,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
hap100PSuppP2 <- ggplot(hap100PSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(hap100PSuppP2 + blankTheme, hap100SplitP2+blankTheme, ncol=1)
```
Clade3
```{r}
#get support for each split, and split dot matrix
discoPSuppCl3 <- getSplitSupports(discoPTree3,discoGenos[cl3,])
discoPSplitsCl3 <- getSplitPlot(discoPTree3)
#order by most-supported split
splitSort <- discoPSuppCl3$splits[rev(order(discoPSuppCl3$pro))]
discoPSplitsCl3$splits <- factor(discoPSplitsCl3$splits,levels=splitSort, ordered=T)
discoSplitP3 <- ggplot(discoPSplitsCl3,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
discoPSuppP3 <- ggplot(discoPSuppCl3,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(discoPSuppP3 + blankTheme, discoSplitP3+blankTheme, ncol=1)
```
```{r}
#get support for each split, and split dot matrix
hap250PSuppCl3 <- getSplitSupports(hap250PTree3,hap250Genos[cl3,])
hap250PSplitsCl3 <- getSplitPlot(hap250PTree3)
#order by most-supported split
splitSort <- hap250PSuppCl3$splits[rev(order(hap250PSuppCl3$pro))]
hap250PSplitsCl3$splits <- factor(hap250PSplitsCl3$splits,levels=splitSort, ordered=T)
hap250PSuppCl3$splits <- factor(hap250PSuppCl3$splits,levels=splitSort, ordered=T)
hap250SplitP3 <- ggplot(hap250PSplitsCl3,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
hap250PSuppP3 <- ggplot(hap250PSuppCl3,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(hap250PSuppP3 + blankTheme, hap250SplitP3+blankTheme, ncol=1)
```
```{r}
#get support for each split, and split dot matrix
hap100PSuppCl3 <- getSplitSupports(hap100PTree3,hap100Genos[cl3,])
hap100PSplitsCl3 <- getSplitPlot(hap100PTree3)
#order by most-supported split
splitSort <- hap100PSuppCl3$splits[rev(order(hap100PSuppCl3$pro))]
hap100PSplitsCl3$splits <- factor(hap100PSplitsCl3$splits,levels=splitSort, ordered=T)
hap100PSuppCl3$splits <- factor(hap100PSuppCl3$splits,levels=splitSort, ordered=T)
hap100SplitP3 <- ggplot(hap100PSplitsCl3,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
hap100PSuppP3 <- ggplot(hap100PSuppCl3,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750)
grid.arrange(hap100PSuppP3 + blankTheme, hap100SplitP3+blankTheme, ncol=1)
```
```{r}
opts_chunk$set(fig.width=16, fig.height=9)
opts_chunk$set(dev=c('png','postscript'))
#opts_chunk$set(dev=c('png'))
```
```{r}
grid.arrange(discoPSuppP1 + blankTheme, hap250PSuppP1 + blankTheme, hap100PSuppP1 + blankTheme,
discoSplitP1+blankTheme, hap250SplitP1+blankTheme, hap100SplitP1+blankTheme,
ncol=3)
grid.arrange(discoPSuppP2 + blankTheme, hap250PSuppP2 + blankTheme, hap100PSuppP2 + blankTheme,
discoSplitP2+blankTheme, hap250SplitP2+blankTheme, hap100SplitP2+blankTheme,
ncol=3)
grid.arrange(discoPSuppP3 + blankTheme, hap250PSuppP3 + blankTheme, hap100PSuppP3 + blankTheme,
discoSplitP3+blankTheme, hap250SplitP3+blankTheme, hap100SplitP3+blankTheme,
ncol=3)
```
knit("variantsOnTrees.Rmd")
knit("variantsOnTrees.Rmd")
mean(discoPSuppCl1[,4]/rowSums(discoPSuppCl1[,4:5]))
mean(hap250PSuppCl1[,4]/rowSums(hap250PSuppCl1[,4:5]))
mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5]))
hap100PSuppCl1$splits[5]
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(x=hap100PSuppCl1$splits[5],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(x=hap100PSuppCl1$splits[5],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(x=hap100PSuppCl1$splits[5],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(x=hap100PSuppCl1$splits[5],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(x=hap100PSuppCl1$splits[5],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100PSuppP1
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(x=hap100PSuppCl1$splits[[5]],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=hap100PSuppCl1$splits[[5]],y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=hap100PSuppCl1$splits[[5]],y=500,label="this")
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=5,y=500,label="this")
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=5,y=500,label=round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2))
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
label = paste("mean split \nsupport: ",round(mean(hap100PSuppCl1[,4]/rowSums(hap100PSuppCl1[,4:5])),2),sep="")
label
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=5,y=500,label=label)
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
?geom_text
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=5,y=500,label=label,hjust=0)
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap100PSuppP1 <- ggplot(hap100PSuppCl1,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + geom_text(inherit.aes=F,x=5,y=1000,label=label,hjust=0)
hap100SplitP1 <- ggplot(hap100PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
grid.arrange(hap100PSuppP1 + blankTheme, hap100SplitP1+blankTheme, ncol=1)
hap250SplitP1 <- ggplot(hap250PSplitsCl1,aes(x=splits,y=sample,fill=insplit)) + geom_point(shape=21, size=3) + scale_fill_manual(values=c(NA,"black"),guide=F)
label = paste("mean split\nsupport: ",round(mean(hap250PSuppCl2[,4]/rowSums(hap250PSuppCl2[,4:5])),2),sep="")
knit("variantsOnTrees.Rmd")
knit("variantsOnTrees.Rmd")
discoPSuppP2 <- ggplot(discoPSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + annotate("text",x=2,y=1000,label=label,hjust=0,size=3)
grid.arrange(discoPSuppP2 + blankTheme, discoSplitP2+blankTheme, ncol=1)
discoPSuppP2 <- ggplot(discoPSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + annotate("text",x=2,y=1000,label=label,hjust=0,size=8)
grid.arrange(discoPSuppP2 + blankTheme, discoSplitP2+blankTheme, ncol=1)
discoPSuppP2 <- ggplot(discoPSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + annotate("text",x=2,y=1000,label=label,hjust=0,size=6)
grid.arrange(discoPSuppP2 + blankTheme, discoSplitP2+blankTheme, ncol=1)
knit("variantsOnTrees.Rmd")
grid.arrange(discoPSuppP1 + blankTheme, hap250PSuppP1 + blankTheme, hap100PSuppP1 + blankTheme,
discoSplitP1+blankTheme, hap250SplitP1+blankTheme, hap100SplitP1+blankTheme,
ncol=3)
?grid.arrange
getGrob(gTree, gPath)
?getGrob
ggplotGrob(discoPSuppCl1)
ggplotGrob(discoPSuppCl1)
Pgrob <- ggplotGrob(discoPSuppCl1)
?ggplotGrob
hap250PSuppP2 <- ggplotGrob(hap250PSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + annotate("text",x=2,y=1000,label=label,hjust=0,size=6)
hap250PSuppP2 <- ggplot(hap250PSuppCl2,aes(x=splits)) + geom_bar(aes(y=pro),stat="identity",fill="blue") + geom_bar(aes(y=(anti*-1)),stat="identity",fill="red") + ylim(-1000,1750) + annotate("text",x=2,y=1000,label=label,hjust=0,size=6)
Pgrob <- ggplotGrob(discoPSuppCl1)
Pgrob <- getGrob(discoPSuppCl1)
Pgrob <- grob(discoPSuppCl1)
?grob
blank <- grid.rect(gp=gpar(col="white"))
?grid.arrange
grid.arrange(blank,discoPSuppP1 + blankTheme,
blank,hap250PSuppP1 + blankTheme,
blank,hap100PSuppP1 + blankTheme,
blank,discoSplitP1+blankTheme,
blank,hap250SplitP1+blankTheme,
blank,hap100SplitP1+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
blank <- grid.rect(gp=gpar(col="white"))
grid.arrange(blank,discoPSuppP1 + blankTheme,
blank,hap250PSuppP1 + blankTheme,
blank,hap100PSuppP1 + blankTheme,
blank,discoSplitP1+blankTheme,
blank,hap250SplitP1+blankTheme,
blank,hap100SplitP1+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
library(grid)
grid.arrange(blank,discoPSuppP1 + blankTheme,
blank,hap250PSuppP1 + blankTheme,
blank,hap100PSuppP1 + blankTheme,
blank,discoSplitP1+blankTheme,
blank,hap250SplitP1+blankTheme,
blank,hap100SplitP1+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
blank <- grid.rect(gp=gpar(col="white"))
grid.arrange(blank,discoPSuppP1 + blankTheme,
blank,hap250PSuppP1 + blankTheme,
blank,hap100PSuppP1 + blankTheme,
blank,discoSplitP1+blankTheme,
blank,hap250SplitP1+blankTheme,
blank,hap100SplitP1+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
grid.arrange(discoPSuppP2 + blankTheme, hap250PSuppP2 + blankTheme, hap100PSuppP2 + blankTheme,
discoSplitP2+blankTheme, hap250SplitP2+blankTheme, hap100SplitP2+blankTheme,
ncol=3)
grid.arrange(blank,discoPSuppP1 + blankTheme,
blank,hap250PSuppP1 + blankTheme,
blank,hap100PSuppP1 + blankTheme,
blank,discoSplitP1+blankTheme,
blank,hap250SplitP1+blankTheme,
blank,hap100SplitP1+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
grid.arrange(blank,discoPSuppP2 + blankTheme,
blank,hap250PSuppP2 + blankTheme,
blank,haP200PSuppP2 + blankTheme,
blank,discoSplitP2+blankTheme,
blank,hap250SplitP2+blankTheme,
blank,hap100SplitP2+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
grid.arrange(blank,discoPSuppP2 + blankTheme,
blank,hap250PSuppP2 + blankTheme,
blank,hap100PSuppP2 + blankTheme,
blank,discoSplitP2+blankTheme,
blank,hap250SplitP2+blankTheme,
blank,hap100SplitP2+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
grid.arrange(blank,discoPSuppP2 + blankTheme,
blank,hap250PSuppP2 + blankTheme,
blank,hap100PSuppP2 + blankTheme,
blank,discoSplitP2+blankTheme,
blank,hap250SplitP2+blankTheme,
blank,hap100SplitP2+blankTheme,
ncol=6,widths=c(1,6,1,6,1,6))
knit("variantsOnTrees.Rmd")
knit("variantsOnTrees.Rmd")
opts_chunk$set(fig.width=21, fig.height=9)
opts_chunk$set(dev=c('png','postscript'))
knit("variantsOnTrees.Rmd")
knit("variantsOnTrees.Rmd")
knit("variantsOnTrees.Rmd")
knit("variantsOnTrees.Rmd")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.tree("thies_haplo100.FILT.m0.5.alleles.tab")
plot(hap100PTree)
hap100PTree <- read.tree("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree1 <- drop.tip(hap100PTree,c(cl2,cl3))
hap100PTree <- read.tree("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus.data("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus(file="thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus(file="thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus(file="thies_haplo100.FILT.m0.5.alleles.tab",tree.names=c("UNTITLED"))
hap100PTree <- read.nexus(file="thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus(file="thies_haplo250.FILT.m0.5.alleles.tab")
?ape
hap100PTree <- read.tree("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree1 <- drop.tip(hap100PTree,c(cl2,cl3))
knit("variantsOnTrees.Rmd")
read.nexus("thies_disco.FILT.m0.5.vcf.gz.PARS.nexus")
discoPTree <- read.nexus("thies_disco.FILT.m0.5.vcf.gz.PARS.nexus")
discoPTree1 <- drop.tip(discoPTree,c(cl2,cl3))
discoPTree2 <- drop.tip(discoPTree,c(cl3,cl1))
discoPTree3 <- drop.tip(discoPTree,c(cl1,cl2))
plot(discoPTree)
plot(discoPTree1)
plot(discoPTree2)
plot(discoPTree3)
hap250Alleles <- read.table("thies_haplo250.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
hap250Genos <- t(data.matrix(hap250Alleles[6:dim(hap250Alleles)[2]]))
inds <- row.names(hap250Genos)
genosDat <- as.phyDat(hap250Genos, type="USER", levels = c(0:max(hap250Genos,na.rm=T)))
hap250PTree <- read.nexus("thies_haplo250.FILT.m0.5.vcf.gz.PARS.nexus")
hap250PTree1 <- drop.tip(hap250PTree,c(cl2,cl3))
hap250PTree2 <- drop.tip(hap250PTree,c(cl3,cl1))
hap250PTree3 <- drop.tip(hap250PTree,c(cl1,cl2))
plot(hap250PTree)
plot(hap250PTree1)
plot(hap250PTree2)
plot(hap250PTree3)
hap100Alleles <- read.table("thies_haplo100.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
cnames <- gsub("SM.","SM-",colnames(hap100Alleles))
cnames[cnames %in% names(samples)] <- samples[cnames[cnames %in% names(samples)]]
colnames(hap100Alleles) <- cnames
hap100Genos <- t(data.matrix(hap100Alleles[6:dim(hap100Alleles)[2]]))
inds <- row.names(hap100Genos)
genosDat <- as.phyDat(hap100Genos, type="USER", levels = c(0:max(hap100Genos,na.rm=T)))
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
samples
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
library(ape)
library(knitr)
library(RColorBrewer)
library(ggplot2)
library(reshape2)
require(gridExtra)
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.alleles.tab")
hap250PTree <- read.nexus("thies_haplo250.FILT.m0.5.vcf.gz.PARS.nexus")
hap100PTree <- read.nexus("thies_haplo100.FILT.m0.5.vcf.gz.PARS.nexus")
hap100PTree1 <- drop.tip(hap100PTree,c(cl2,cl3))
knit("variantsOnTrees.mRd")
knit("variantsOnTrees.Rmd")
grid.arrange(discoPSuppP1, discoSplitP, ncol=1)
grid.arrange(discoPSuppP1, discoSplitP1, ncol=1)
knit("variantsOnTrees.Rmd")
h250nj <- nj(as.dist(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt")))
as.dist(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt"))
as.dist(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t"))
read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t")
sym <- function(M) {
M[lower.tri(M)] = t(M)[lower.tri(M)]
M
}
sym(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t"))
as.dist(sym(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t")))
nj(as.dist(sym(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t"))))
h250nj <- nj(as.dist(sym(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t"))))
plot (h250nj)
?nj
h250Dist <- as.dist(sym(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t")))
h250Dist[cl1,cl1]
cl1 <- c("Th086.07", "Th106.09", "Th106.11", "Th117.11", "Th132.11", "Th134.11", "Th162.12", "Th196.12", "Th230.12", "Th074.13")
h250Dist[cl1,cl1]
h250Dist[cl1,]
h250Dist[cl1]
h250Dist <- sym(read.table("thies_haplo250.FILT.m0.5.vcf.gz.dist.tab.txt",sep="\t"))
h250Dist[cl1,cl1]
plot(h250nj)
h250nj <- midpoint(h250nj)
plot(h250nj)
hap250Genos <- t(data.matrix(hap250Alleles[6:dim(hap250Alleles)[2]]))
inds <- row.names(hap250Genos)
hap250Alleles <- read.table("thies_haplo250.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
hap250Genos <- t(data.matrix(hap250Alleles[6:dim(hap250Alleles)[2]]))
inds <- row.names(hap250Genos)
genosDat <- as.phyDat(hap250Genos, type="USER", levels = c(0:max(hap250Genos,na.rm=T)))
as.dist(hap250Genos)
hap250Genos
dist(hap250Genos)
plot(nj(dist(hap250Genos)))
plot(midpoint(nj(dist(hap250Genos))))
discoAlleles <- read.table("thies_disco.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
discoGenos <- t(data.matrix(discoAlleles[6:dim(discoAlleles)[2]]))
inds <- row.names(discoGenos)
genosDat <- as.phyDat(discoGenos, type="USER", levels = c(0:max(discoGenos,na.rm=T)))
hap100Alleles <- read.table("thies_haplo100.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
cnames <- gsub("SM.","SM-",colnames(hap100Alleles))
cnames[cnames %in% names(samples)] <- samples[cnames[cnames %in% names(samples)]]
colnames(hap100Alleles) <- cnames
samples <- read.table("../180224_core_callable_VQSLOD90/Thies.samples.txt",col.names=c("ID","lane","dataset","sample","bam"))
samples <- unique(samples[,c("ID","sample")])
snames <- samples[,c("ID")]; samples<- as.character(samples[,c("sample")]) ; names(samples) <- snames
hap100Alleles <- read.table("thies_haplo100.FILT.m0.5.alleles.tab",colClasses="character",header=T,na.strings = c("."))
cnames <- gsub("SM.","SM-",colnames(hap100Alleles))
cnames[cnames %in% names(samples)] <- samples[cnames[cnames %in% names(samples)]]
colnames(hap100Alleles) <- cnames
hap100Genos <- t(data.matrix(hap100Alleles[6:dim(hap100Alleles)[2]]))
plot(midpoint(nj(dist(hap100Genos))))
plot(midpoint(nj(dist(hap250Genos))))
plot(midpoint(nj(dist(discoGenos))))
discoNJtree <- nj(as.dist(sym(discoDists)))
library(ape)
library(adegenet)
library(phangorn)
library(knitr)
library(igraph)
library(RColorBrewer)
library(ggplot2)
library(reshape2)
#opts_chunk$set(fig.width=9, fig.height=9)
#opts_chunk$set(dev=c('png','postscript'))
opts_chunk$set(fig.width=12, fig.height=9)
opts_chunk$set(dev=c('png'))
sym <- function(M) {
M[lower.tri(M)] = t(M)[lower.tri(M)]
M
}
makeDist <- function(distance_matrix_file, meta_file, ngroups=3) {
mat <- read.table(distance_matrix_file,sep="\t")
D <- as.dist(sym(mat))
clust <- gengraph(D,ngrp=ngroups)
names <- colnames(mat)
mat <- as.matrix(mat)
name1 <- names[clust$clust$membership==1]
name2 <- names[clust$clust$membership==2]
name3 <- names[clust$clust$membership==3]
dist1 <- mat[name1,name1]
dist2 <- mat[name2,name2]
dist3 <- mat[name3,name3]
list(dist1,dist2,dist3)
}
meta <- read.table("Thies_metadata_1701.txt",sep="\t",header=T)
colnames(meta)[1]<-"name"
meta <- meta[!is.na(meta$Age),]
discoDists <- read.table("thies_disco.FILT.m0.5.dist.tab.txt",header=T,sep="\t")
meta <- subset(meta,name %in% names(discoDists))
rownames(meta) <- meta$name
hap100Dists <- read.table("thies_haplo100.FILT.m0.5.dist.tab.txt",header=T,sep="\t")
hap250Dists <- read.table("thies_haplo250.FILT.m0.5.dist.tab.txt",header=T,sep="\t")
samples <- read.table("Thies.samples.txt",col.names=c("ID","lane","dataset","sample","bam"))
samples <- unique(samples[,c("ID","sample")])
snames <- samples[,c("ID")]; samples<- as.character(samples[,c("sample")]) ; names(samples) <- snames
#fix names for hap100 tree
names(hap100Dists) <- samples[rownames(hap100Dists)]
rownames(hap100Dists) <- samples[rownames(hap100Dists)]
setwd("../180224_MEP_haplo100Haplo250Disco/")
