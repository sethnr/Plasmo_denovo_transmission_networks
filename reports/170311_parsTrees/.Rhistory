setwd("/Volumes//gsap_garage-protistvector/sredmond/broad_10Xmicrobial/reports/160824_snr_snp_LDs/")
knit("snpLDReport.Rmd")
library(knitr)
knit("snpLDReport.Rmd")
knit("snpLDReport.Rmd")
plotmatrix(ld55,aes())
library(ggplot2)
library(hexbin)
library(reshape2)
library(knitr)
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)
```{r setup}
opts_chunk$set(fig.width=12, fig.height=8,dev='png',warning=F)
```
```{r}
ld55 <- read.table("HuMal900505.vcf.gz.bx.2.Pf3D7_09_v31000000-1500000.ld",header=F,stringsAsFactors=F)
ld55$sample="0505"
ld91 <- read.table("HuMal900505.vcf.gz.bx.2.Pf3D7_09_v31000000-1500000.ld",header=F,stringsAsFactors=F)
ld91$sample="0901"
ld <- rbind(ld91,ld55)
posns = read.table("HuMal900505.vcf.gz.bx.2.Pf3D7_09_v31000000-1500000.map")[,4]
colnames(ld55)<-posns
rownames(ld55)<-posns
melt(ld55)
ggplot(ld,aes(x=SNP_A,y=SNP_B,colour=R2)) + geom_tile() + facet_grid(. ~ sample)
head(ld)
ldm <- melt(ld55)
head(ldm)
plotmatrix(ld55,aes())
library(ggplot2)
plotmatrix(ld55,aes())
ldm
ldm <- melt(ld)
head(ld)
setwd("~/Scratch/gits/pfdisco/analyses/")
ll
setwd("~/Scratch/gits/pfdisco/analyses/TREES/pars_trees/")
library(ggplot2)
library(ape)
library(stringdist)
library(reshape2)
library(phangorn)
fileroot<-"Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.miss-1.alleles"
outfolder <- "boot_allvars"
tab=paste(fileroot,'tab',sep='.')
outpng=paste(fileroot,'png',sep='.')
outnex=paste(fileroot,'nexus',sep='.')
outtab=paste(fileroot,'dist.tab.txt',sep='.')
#read in ped file and get hamming distances:
alleleTab <- read.table(tab,colClasses="character",header=T,na.strings = c("."))
genos <- t(data.matrix(alleleTab[6:dim(alleleTab)[2]]))
inds <- row.names(genos)
genosDat <- as.phyDat(genos, type="USER", levels = c(0:max(genos,na.rm=T)))
distmat <- dist.hamming(genosDat,exclude="pairwise")
treeNJ <- NJ(distmat)
distmat
parsimony(treeNJ,genosDat)
write("getting parsimony tree",stderr())
treeRatchet <- pratchet(genosDat)
write(str(treeRatchet))
plot(treeRatchet)
distmat
distmat*3200
write("midpoint root",stderr())
treeRatchet <- midpoint(treeRatchet)
read.table("../nj_trees//njtree_thies/Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt")
read.table("../nj_trees//njtree_thies/Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")
read.table("../nj_trees//njtree_thies/Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")
setwd("~/Scratch/gits/pfdisco/reports/170311_parsTrees/")
read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")
read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")
as.dist(read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t"))
as.dist(sym(read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")))
sym <- function(M) {
M[lower.tri(M)] = t(M)[lower.tri(M)]
M
}
as.dist(sym(read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")))
distmat <- as.dist(sym(read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")))
treeNJ <- NJ(distmat)
parsimony(treeNJ,genosDat)
write("getting parsimony tree",stderr())
treeRatchet <- pratchet(genosDat)
write(str(treeRatchet))
write("re-adding distances",stderr())
write(paste("symmetric",isSymmetric(as.matrix(distmat))),stderr())
treeRatchet <- nnls.phylo(treeRatchet,distmat)
#write(treeRatchet,stderr())
write("midpoint root",stderr())
treeRatchet <- midpoint(treeRatchet)
write("printing tree",stderr())
plot.new()
plot(treeRatchet,show.node.label = T,show.tip.label = T,
main=paste("parsimony ratchet, ",fileroot),type="phylogram",cex = 1.1)
?plot
?plot.phylo
knit("getParsTreePed.Rmd")
library("knitr")
knit("getParsTreePed.Rmd")
treeRatchet <- nnls.phylo(treeRatchet,distmat)
treeRatchet <- pratchet(genosDat)
plot(treeRatchet,show.node.label = T,show.tip.label = T,
main=paste("parsimony ratchet, ",fileroot),type="phylogram",cex = 1.1)
distmat2 <- as.dist(sym(read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")))
distmat <- dist.hamming(genosDat,exclude="pairwise")
treeNJ <- NJ(distmat)
#
#distmat2 <- matrix(nrow=length(inds),ncol=length(inds))
#colnames(distmat2) = inds
#rownames(distmat2) = inds
#write("calculating distance matrix",stderr())
#for (i in rownames(genos)){
#   for (j in rownames(genos)){
#      notnull <- !(is.na(genos[i,]) | is.na(genos[j,]))
#
#      distmat2[i,j] <- sum(genos[i,notnull] != genos[j,notnull])
#  }
#}
#get parsinomy score
parsimony(treeNJ,genosDat)
#get parsinomy tree
#treePars <- optim.parsimony(treeNJ,genosDat)
write("getting parsimony tree",stderr())
treeRatchet <- pratchet(genosDat)
write(str(treeRatchet))
#re-add distances
#write.table(as.matrix(distmat),stderr())
write("re-adding distances",stderr())
write(paste("symmetric",isSymmetric(as.matrix(distmat))),stderr())
treeRatchet <- nnls.phylo(treeRatchet,distmat2)
#write(treeRatchet,stderr())
write("midpoint root",stderr())
treeRatchet <- midpoint(treeRatchet)
#write(treeRatchet,stderr())
#parsimony(c(treePars,treeRatchet),genosDat)
#plot(treePars,"unrooted",main="parsimony: NNI swaps")
write("printing tree",stderr())
#png(filename=outpng,type="cairo-png")
plot.new()
plot(treeRatchet,show.node.label = T,show.tip.label = T,
main=paste("parsimony ratchet, ",fileroot),type="phylogram",cex = 1.1)
write.nexus(treeRatchet,file=outnex)
write("getting parsimony tree",stderr())
treeRatchet <- pratchet(genosDat)
write(str(treeRatchet))
distmat2 <- as.dist(sym(read.table("Thies_all_manual.PASS.Cls.miss0.5.LMRG.HAP.vcf.dist.tab.txt",sep="\t")))
distmat <- dist.hamming(genosDat,exclude="pairwise")
treeNJ <- NJ(distmat)
parsimony(treeNJ,genosDat)
write("getting parsimony tree",stderr())
treeRatchet <- pratchet(genosDat)
write(str(treeRatchet))
write("re-adding distances",stderr())
write(paste("symmetric",isSymmetric(as.matrix(distmat))),stderr())
treeRatchet <- nnls.phylo(treeRatchet,distmat2)
write("midpoint root",stderr())
treeRatchet <- midpoint(treeRatchet)
write("printing tree",stderr())
plot.new()
plot(treeRatchet,show.node.label = T,show.tip.label = T,
main=paste("parsimony ratchet, ",fileroot),type="phylogram",cex = 1.1)
write.nexus(treeRatchet,file=outnex)
head(alleleTab)
table(alleleTab$TYPE)
table(alleleTab$type)
alleleTab[,6:dim(alleleTab)[2]]
apply(alleleTab[,6:dim(alleleTab)[2]],1,function(x) {length(unique(na.omit(x)))})
apply(alleleTab[,6:dim(alleleTab)[2]],1,function(x) {length(unique(na.omit(x)))>1})
sum(apply(alleleTab[,6:dim(alleleTab)[2]],1,function(x) {length(unique(na.omit(x)))>1}))
alleleTab$var <- apply(alleleTab[,6:dim(alleleTab)[2]],1,function(x) {length(unique(na.omit(x)))>1})
sum(alleleTab$var & alleleTab$type=="SNP")
sum(alleleTab$var & alleleTab$type=="INDEL")
